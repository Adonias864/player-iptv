<script>
function carregarLista() {
  const texto = document.getElementById("m3u").value.trim();
  const linhas = texto.split(/\r?\n/);
  const lista = document.getElementById("lista");
  lista.innerHTML = "";

  for (let i = 0; i < linhas.length; i++) {
    if (linhas[i].includes("#EXTINF")) {
      let nome = linhas[i].split(",").pop();
      let url = "";

      // procura o próximo link válido
      for (let j = i + 1; j < linhas.length; j++) {
        if (linhas[j].startsWith("http")) {
          url = linhas[j].trim();
          break;
        }
      }

      if (url !== "") {
        const canal = document.createElement("div");
        canal.textContent = nome;
        canal.onclick = () => play(url);
        lista.appendChild(canal);
      }
    }
  }

  if (lista.innerHTML === "") {
    alert("Nenhum canal encontrado. Verifique o formato da lista M3U.");
  }
}

function play(url) {
  const video = document.getElementById("video");
  video.pause();
  video.src = "";
  
  if (Hls.isSupported()) {
    const hls = new Hls();
    hls.loadSource(url);
    hls.attachMedia(video);
  } else {
    video.src = url;
  }
}
</script>
